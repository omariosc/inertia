<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: staff/StaffManageIssues.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: staff/StaffManageIssues.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* eslint-disable react/prop-types */
/* Purpose of file: Display list of outstanding issues to staff and
allow them to filter to find specific issues and close/escalate them */

import React, {useEffect, useState} from 'react';
import {Button, Col, Container, Form, Row} from 'react-bootstrap';
import {NotificationManager} from 'react-notifications';
import {useAccount} from '../authorize';
import getAge from './getAge';
import accountRole from './accountRole';
import host from '../host';
import priorities from './priorities';
import userType from './userType';
import {useNavigate} from 'react-router-dom';

/**
 * Renders the manage issue page
 * @return {JSX.Element} The manage issue page
 */
export default function StaffManageIssues({manager}) {
  const navigate = useNavigate();
  const [account] = useAccount();
  const [issues, setIssues] = useState('');
  const [showAdvancedFilters, setShowAdvancedFilters] = useState(true);
  const [searchTitle, setSearchTitle] = useState('');
  const [searchIssueID, setSearchIssueID] = useState('');
  const [searchPriority, setSearchPriority] = useState('All');
  const [searchContent, setSearchContent] = useState('');
  const [searchAccountID, setSearchAccountID] = useState('');
  const [searchAccountName, setSearchAccountName] = useState('');
  const [searchAccountEmail, setSearchAccountEmail] = useState('');
  const [searchAccountRole, setSearchAccountRole] = useState('All');
  const [searchAccountType, setSearchAccountType] = useState('All');
  const [searchBefore, setSearchBefore] = useState('');
  const [searchAfter, setSearchAfter] = useState('');

  useEffect(() => {
    fetchIssues();
  }, []);

  /**
   * Gets the issues from the backend server
   * @param {number} sortOption How the issues are sorted
   */
  async function fetchIssues(sortOption = null) {
    try {
      const request = await fetch(host +
          `api/admin/Issues/?closed=false${(manager) ? '&amp;priority=3' : ''}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json',
          'Authorization': `Bearer ${account.accessToken}`,
        },
        mode: 'cors',
      });
      const sortFunctions = {
        '1': (a, b) => b.issueId - a.issueId,
        '2': (a, b) => a.issueId - b.issueId,
        '3': (a, b) => a.priority - b.priority,
        '4': (a, b) => b.priority - a.priority,
      };
      setIssues((await request.json()).sort(sortFunctions[sortOption]));
      if (sortOption) {
        NotificationManager.success('Sorted Issues.', 'Success');
      }
    } catch (error) {
      console.error(error);
    }
  }

  /**
   * Shows or hides advanced filtering for issues
   */
  function toggleAdvancedFilters() {
    if (showAdvancedFilters) {
      setSearchIssueID('');
      setSearchPriority('All');
      setSearchContent('');
      setSearchAccountID('');
      setSearchAccountName('');
      setSearchAccountEmail('');
      setSearchAccountRole('All');
      setSearchAccountType('All');
      setSearchBefore('');
      setSearchAfter('');
      setShowAdvancedFilters(false);
    } else {
      setShowAdvancedFilters(true);
    }
  }

  return (
    &lt;>
      {(manager) ?
            &lt;p id="breadcrumb">
              &lt;a className="breadcrumb-list" onClick={() => {
                account.role === '2' ?
                    navigate('/dashboard') :
                    navigate('/home');
              }}>Home
              &lt;/a> &amp;gt; &lt;a className="breadcrumb-list" onClick={() => {
                navigate('/issues');
              }}>Issues&lt;/a> &amp;gt; &lt;b>
                &lt;a className="breadcrumb-current" onClick={() => {
                  navigate('/issues');
                }}>High Priority Issues&lt;/a>&lt;/b>
            &lt;/p> :
            &lt;p id="breadcrumb">
              &lt;a className="breadcrumb-list"
                onClick={() => {
                   account.role === '2' ?
                       navigate('/dashboard') :
                       navigate('/home');
                }}>Home&lt;/a> &amp;gt; &lt;b>
                &lt;a className="breadcrumb-current" onClick={() => {
                  navigate('/issues');
                }}>Issues&lt;/a>&lt;/b>
            &lt;/p>
      }
      &lt;h3 id="pageName">Issues&lt;/h3>
      &lt;hr id="underline"/>
      &lt;Container className="p-3">
        &lt;div className="issue-filters">
          &lt;Row className="p-2">
            &lt;Col className="col-8">
              &lt;Form.Control type="text"
                onChange={(event) => {
                  setSearchTitle(event.target.value);
                }}
                placeholder="Search Issue Titles"/>
            &lt;/Col>
            &lt;Col className="col-2">
              &lt;Button type="button"
                className={showAdvancedFilters ?
                            'btn-danger' :
                            'btn-primary'}
                onClick={() => {
                  toggleAdvancedFilters();
                }}>
                {showAdvancedFilters ? 'Hide Filters' : 'Show Filters'}

              &lt;/Button>
            &lt;/Col>

            &lt;Col>
              &lt;Form.Select onChange={(e) => {
                fetchIssues(e.target.value);
              }}>
                &lt;option value={1}>Time: Newest&lt;/option>
                &lt;option value={2}>Time: Oldest&lt;/option>
                {(manager) ? null :
                      &lt;>
                        &lt;option value={3}>Priority: Ascending&lt;/option>
                        &lt;option value={4}>Priority: Descending&lt;/option>
                      &lt;/>
                }
              &lt;/Form.Select>
            &lt;/Col>
          &lt;/Row>
          {showAdvancedFilters &amp;&amp;
                &lt;>
                  &lt;Row className="p-2">
                    &lt;Col className="col-2">
                      Before
                    &lt;/Col>
                    &lt;Col className="col-2">
                      &lt;Form.Control type="date"
                        onChange={(event) => setSearchBefore(
                            event.target.value)}
                      />
                    &lt;/Col>
                    &lt;Col className="col-2">
                      After
                    &lt;/Col>
                    &lt;Col className="col-2">
                      &lt;Form.Control type="date"
                        onChange={(event) => setSearchAfter(
                            event.target.value)}
                      />
                    &lt;/Col>
                    &lt;Col className="col-2">
                      Priority
                    &lt;/Col>
                    &lt;Col className="col-2">
                      {(manager) ? &lt;>High&lt;/> :
                          &lt;Form.Select onChange={(e) => {
                            setSearchPriority(e.target.value);
                          }}>
                            &lt;option value="All" key="All">All&lt;/option>
                            {priorities.map((pString, pValue) => (
                              &lt;option value={pValue}
                                key={pValue}>{pString}&lt;/option>
                            ))}
                          &lt;/Form.Select>
                      }
                    &lt;/Col>
                  &lt;/Row>
                  &lt;Row className="p-2">
                    &lt;Col className="col-2">
                      Issue ID
                    &lt;/Col>
                    &lt;Col className="col-2">
                      &lt;Form.Control type="input"
                        onChange={(event) => setSearchIssueID(
                            event.target.value)}
                      />
                    &lt;/Col>
                    &lt;Col className="col-2">
                      Account ID
                    &lt;/Col>
                    &lt;Col className="col-2">
                      &lt;Form.Control type="input"
                        onChange={(event) => setSearchAccountID(
                            event.target.value)}
                      />
                    &lt;/Col>
                    &lt;Col className="col-2">
                      Account Type
                    &lt;/Col>
                    &lt;Col className="col-2">
                      &lt;Form.Select onChange={(e) => {
                        setSearchAccountRole(e.target.value);
                      }}>
                        &lt;option value="All" key="All">All&lt;/option>
                        {accountRole.map((aRString, aRValue) => (
                          &lt;option value={aRValue}
                            key={aRValue}>{aRString}&lt;/option>
                        ))}
                      &lt;/Form.Select>
                    &lt;/Col>
                  &lt;/Row>
                  &lt;Row className="p-2">
                    &lt;Col className="col-2">
                      Username
                    &lt;/Col>
                    &lt;Col className="col-2">
                      &lt;Form.Control type="input"
                        onChange={(event) => setSearchAccountName(
                            event.target.value)}
                      />
                    &lt;/Col>
                    &lt;Col className="col-2">
                      Email
                    &lt;/Col>
                    &lt;Col className="col-2">
                      &lt;Form.Control type="input"
                        onChange={(event) => setSearchAccountEmail(
                            event.target.value)}
                      />
                    &lt;/Col>
                    &lt;Col className="col-2">
                      User Type
                    &lt;/Col>
                    &lt;Col className="col-2">
                      &lt;Form.Select onChange={(e) => {
                        setSearchAccountType(e.target.value);
                      }}>
                        &lt;option value="All" key="All">All&lt;/option>
                        {userType.map((uTString, uTValue) => (
                          &lt;option value={uTValue}
                            key={uTString}>{uTString}&lt;/option>
                        ))}
                      &lt;/Form.Select>
                    &lt;/Col>
                  &lt;/Row>
                  &lt;Row className="p-2">
                    &lt;Col className="col-2">
                      Content Included
                    &lt;/Col>
                    &lt;Col className="col-10">
                      &lt;Form.Control as="textarea" rows={2}
                        onInput={(e) => setSearchContent(
                            e.target.value)}/>

                    &lt;/Col>
                  &lt;/Row>
                &lt;/>
          }
        &lt;/div>
        &lt;div className="issue-filters-mobile">
          &lt;Form.Control type="text"
            onChange={(event) => {
              setSearchTitle(event.target.value);
            }}
            placeholder="Search Issue Titles"/>
          &lt;br/>
          &lt;Row>
            &lt;Col>
              &lt;Form.Select onChange={(e) => {
                fetchIssues(e.target.value);
              }}>
                &lt;option value={1}>Time: Newest&lt;/option>
                &lt;option value={2}>Time: Oldest&lt;/option>
                {(manager) ? null :
                      &lt;>
                        &lt;option value={3}>Priority: Ascending&lt;/option>
                        &lt;option value={4}>Priority: Descending&lt;/option>
                      &lt;/>
                }
              &lt;/Form.Select>&lt;/Col>
            &lt;Col>
              &lt;Button type="button"
                className="float-right"
                variant={showAdvancedFilters ? 'danger' : 'primary'}
                onClick={() => {
                  toggleAdvancedFilters();
                }}>
                {showAdvancedFilters ? 'Hide Filters' : 'Show Filters'}
              &lt;/Button>
            &lt;/Col>
          &lt;/Row>
          {showAdvancedFilters &amp;&amp;
                &lt;>
                  &lt;br/>
                  Before
                  &lt;Form.Control type="date"
                    onChange={(event) => setSearchBefore(
                        event.target.value)}
                  />
                  &lt;br/>
                  After
                  &lt;Form.Control type="date"
                    onChange={(event) => setSearchAfter(
                        event.target.value)}
                  />
                  &lt;br/>
                  {(manager) ? null :
                      &lt;>
                        Priority
                        &lt;Form.Select onChange={(e) => {
                          setSearchPriority(e.target.value);
                        }}>
                          &lt;option value="All" key="All">All&lt;/option>
                          {priorities.map((pString, pValue) => (
                            &lt;option value={pValue}
                              key={pValue}>{pString}&lt;/option>
                          ))}
                        &lt;/Form.Select>
                        &lt;br/>
                      &lt;/>
                  }
                  Issue ID
                  &lt;Form.Control type="input"
                    onChange={(event) => setSearchIssueID(
                        event.target.value)}
                  />
                  &lt;br/>
                  Account ID
                  &lt;Form.Control type="input"
                    onChange={(event) => setSearchAccountID(
                        event.target.value)}
                  />
                  &lt;br/>
                  Account Type
                  &lt;Form.Select onChange={(e) => {
                    setSearchAccountRole(e.target.value);
                  }}>
                    &lt;option value="All" key="All">All&lt;/option>
                    {accountRole.map((aRString, aRValue) => (
                      &lt;option value={aRValue}
                        key={aRValue}>{aRString}&lt;/option>
                    ))}
                  &lt;/Form.Select>
                  &lt;br/>
                  Username
                  &lt;Form.Control type="input"
                    onChange={(event) => setSearchAccountName(
                        event.target.value)}
                  />
                  &lt;br/>
                  Email
                  &lt;Form.Control type="input"
                    onChange={(event) => setSearchAccountEmail(
                        event.target.value)}
                  />
                  &lt;br/>
                  User Type
                  &lt;Form.Select onChange={(e) => {
                    setSearchAccountType(e.target.value);
                  }}>
                    &lt;option value="All" key="All">All&lt;/option>
                    {userType.map((uTString, uTValue) => (
                      &lt;option value={uTValue}
                        key={uTString}>{uTString}&lt;/option>
                    ))}
                  &lt;/Form.Select>
                  &lt;br/>
                  Content Included
                  &lt;Form.Control as="textarea" rows={2}
                    onInput={(e) => setSearchContent(
                        e.target.value)}/>
                &lt;/>
          }
        &lt;/div>
        &lt;hr/>
        {(issues.length === 0) ? &lt;p>There are no open issues.&lt;/p> :
              &lt;>
                {issues.filter((issue) => {
                  if (searchTitle !== '' &amp;&amp; !(issue.title.toLowerCase().
                      includes(searchTitle.toLowerCase()))) {
                    return null;
                  }
                  if (searchIssueID !== '' &amp;&amp; searchIssueID !==
                      issue.issueId.toString()) {
                    return null;
                  }

                  if (searchPriority !== 'All' &amp;&amp; searchPriority !==
                      issue.priority.toString()) {
                    return null;
                  }
                  if (searchAccountID !== '' &amp;&amp; searchAccountID !==
                      issue.accountId) {
                    return null;
                  }
                  if (searchAccountName !== '' &amp;&amp; searchAccountName !==
                      issue.account.name) {
                    return null;
                  }
                  if (searchAccountEmail !== '' &amp;&amp;
                      !(issue.account.email.toLowerCase().
                          includes(searchAccountEmail.toLowerCase()))) {
                    return null;
                  }
                  if (searchAccountRole !== 'All' &amp;&amp; searchAccountRole !==
                      issue.account.role.toString()) {
                    return null;
                  }
                  if (searchAccountType !== 'All' &amp;&amp; searchAccountType !==
                      issue.account.userType.toString()) {
                    return null;
                  }
                  let invalid = false;
                  searchContent.split(' ').forEach((term) => {
                    if (!issue.content.toLowerCase().
                        includes(term.toLowerCase())) {
                      invalid = true;
                    }
                  });
                  if (invalid) {
                    return null;
                  }
                  const dateBefore = new Date(searchBefore);
                  dateBefore.setHours(0, 0, 0, 0);
                  const dateAfter = new Date(searchAfter);
                  dateAfter.setHours(0, 0, 0, 0);
                  const dateOf = new Date(
                      issue.dateOpened + '+00:00').getTime();

                  if (dateOf &lt; dateAfter.getTime() + 86400000) {
                    return null;
                  }
                  if (dateOf >= dateBefore.getTime()) {
                    return null;
                  }
                  return issue;
                }).map((issue) => (
                  &lt;a key={issue.issueId} className="breadcrumb-current"
                    onClick={() => {
                      navigate(`../issues/${issue.issueId}`);
                    }}>
                    &lt;Row>
                      &lt;Col xs={8} lg={10} className="issue-filters">
                        &lt;b>{issue.title}&lt;/b>
                      &lt;/Col>
                      &lt;Col xs={5} className="issue-filters-mobile">
                        &lt;b>{issue.title}&lt;/b>
                      &lt;/Col>
                      &lt;Col className="issue-filters-mobile"/>
                      &lt;Col className={`issue-label-${issue.priority}`}>
                        {/* eslint-disable-next-line max-len */}
                        &lt;b className="issue-text">{priorities[issue.priority]}&lt;/b>
                      &lt;/Col>
                    &lt;/Row>
                    &lt;Row>
                      &lt;Col>
                          created by [{accountRole[issue.account.role]}] {
                          issue.account.name} · {getAge(
                            issue.dateOpened + '+00:00')} ago
                      &lt;/Col>
                    &lt;/Row>
                    &lt;hr/>
                  &lt;/a>
                ))}
              &lt;/>
        }
        &lt;br/>
      &lt;/Container>
    &lt;/>
  );
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Account.html">Account</a></li></ul><h3>Global</h3><ul><li><a href="global.html#accountFromCookies">accountFromCookies</a></li><li><a href="global.html#AccountProvider">AccountProvider</a></li><li><a href="global.html#signIn">signIn</a></li><li><a href="global.html#signOut">signOut</a></li><li><a href="global.html#useAccount">useAccount</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Sun May 01 2022 22:09:55 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
