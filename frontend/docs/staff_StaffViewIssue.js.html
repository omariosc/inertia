<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: staff/StaffViewIssue.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: staff/StaffViewIssue.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* Purpose of file: Open the specific overview of an issue to
access detailed information about it */

import React, {useEffect, useState} from 'react';
import {useNavigate, useParams} from 'react-router-dom';
import {Button, Col, Container, Form, Row} from 'react-bootstrap';
import {NotificationManager} from 'react-notifications';
import {useAccount} from '../authorize';
import getAge from './getAge';
import host from '../host';
import priorities from './priorities';

/**
 * Renders the detailed view of a specific issue
 * @return {JSX.Element} View of a specific issue
 */
export default function StaffViewIssue() {
  const navigate = useNavigate();
  const {id} = useParams();
  const [account] = useAccount();
  const [accountName, setAccountName] = useState('');
  const [accountRole, setAccountRole] = useState('');
  const [issue, setIssue] = useState('');
  const [priority, setPriority] = useState('');

  useEffect(() => {
    fetchIssueDetails();
  }, []);

  /**
   * Gets the issue information from the backend server
   */
  async function fetchIssueDetails() {
    try {
      const request = await fetch(host + `api/admin/Issues/${id}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json',
          'Authorization': `Bearer ${account.accessToken}`,
        },
        mode: 'cors',
      });
      const response = await request.json();
      if (response.errorCode) {
        NotificationManager.error('Could not load issue.', 'Error');
        navigate('/issues');
      } else {
        setIssue(response);
        await fetchAccount(response.accountId);
      }
    } catch (error) {
      NotificationManager.error('Could not load issue.', 'Error');
      navigate('/issues');
      console.error(error);
    }
  }

  /**
   * Gets information about the account which raised the issue
   * from the backend server
   * @param {number} accountId The account that created the issue
   */
  async function fetchAccount(accountId) {
    const accountRequest = await fetch(host + `api/admin/Users/${accountId}`, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json',
        'Authorization': `Bearer ${account.accessToken}`,
      },
      mode: 'cors',
    });
    const accountResponse = await accountRequest.json();
    setAccountName(accountResponse.name);
    setAccountRole(accountResponse.role);
  }

  /**
   * Marks an issue as resolved
   */
  async function resolve() {
    try {
      await fetch(host + `api/admin/Issues/${id}`, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json',
          'Authorization': `Bearer ${account.accessToken}`,
        },
        body: JSON.stringify({
          'resolution': 'Resolved',
        }),
        mode: 'cors',
      });
      NotificationManager.success('Resolved issue.', 'Success');
      navigate('/issues');
    } catch (error) {
      console.error(error);
    }
  }

  /**
   * Changes the priority of a specific issue
   */
  async function editPriority() {
    if (priority === '' || priority === 'none') {
      NotificationManager.error('You must select a priority.', 'Error');
      return;
    }
    try {
      await fetch(host + `api/admin/Issues/${id}`, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json',
          'Authorization': `Bearer ${account.accessToken}`,
        },
        body: JSON.stringify({
          'priority': parseInt(priority),
        }),
        mode: 'cors',
      });
      NotificationManager.success('Modified issue priority.', 'Success');
      navigate('/issues');
    } catch (error) {
      console.error(error);
    }
  }

  return (
    &lt;>
      &lt;p id="breadcrumb">
        &lt;a className="breadcrumb-list" onClick={() => {
            (account.role === '2') ? navigate('/dashboard') : navigate('/home');
        }}>Home
        &lt;/a> &amp;gt; &lt;a className="breadcrumb-list" onClick={() => {
          navigate('/issues');
        }}>Issues&lt;/a> &amp;gt; &lt;b>
          &lt;a className="breadcrumb-current" onClick={() => {
            navigate(`/issues/${id}`);
          }}>#{id}&lt;/a>&lt;/b>
      &lt;/p>
      {(issue === '') ? &lt;p>Loading issue details...&lt;/p> :
            &lt;>
              &lt;div className="issue-view">
                &lt;h5 id="pageName">Issue #{id}: {issue.title}&lt;/h5>
                &lt;hr className="issue-divider"/>
                &lt;Container>
                  &lt;Row>
                    &lt;Col xs={6} xg={7} xl={8}>
                      [{(accountRole === '1') ?
                        'Employee' :
                        'Customer'}] {accountName} ·
                      created {getAge(issue.dateOpened + '+00:00')} ago
                    &lt;/Col>
                    &lt;Col xs={2}/>
                    &lt;Col className={`issue-label-${issue.priority}`}>
                      &lt;b className="issue-text">{priorities[issue.priority]}&lt;/b>
                    &lt;/Col>
                  &lt;/Row>
                &lt;/Container>
                &lt;hr className="issue-divider"/>
                &lt;Container>
                  &lt;p>Description: {issue.content}&lt;/p>
                  &lt;br/>
                  &lt;Row>
                    &lt;Col>
                      &lt;Button onClick={resolve}>Mark as Resolved&lt;/Button>
                    &lt;/Col>
                    &lt;Col xs={'auto'}>
                      &lt;Row>
                        &lt;Col xs={'auto'}>
                          &lt;Form.Select defaultValue="none" onChange={(e) => {
                            setPriority(e.target.value);
                          }}>
                            &lt;option value="none" key="none" disabled hidden>
                              Select priority
                            &lt;/option>
                            {priorities.map((priority, idx) => (
                                (issue.priority !== idx &amp;&amp; priority !==
                                    'None') ?
                                    &lt;option value={idx}
                                      key={idx}>{priority}&lt;/option> : null
                            ))}
                          &lt;/Form.Select>
                        &lt;/Col>
                        &lt;Col xs={'auto'}>
                          &lt;Button onClick={editPriority}>
                            {(priority === '' || priority === 'none') ?
                                'Change' :
                                &lt;>
                                  {(issue.priority > parseInt(priority)) ?
                                      'Deescalate' :
                                      'Escalate'} &lt;/>
                            }
                          &lt;/Button>
                        &lt;/Col>
                      &lt;/Row>
                    &lt;/Col>
                  &lt;/Row>
                &lt;/Container>
              &lt;/div>
              &lt;div className="issue-view-mobile">
                &lt;Container>
                  &lt;br/>
                  &lt;Row>
                    &lt;Col xs={6} xg={7} xl={8}>
                      &lt;h5>Issue #{id}: {issue.title}&lt;/h5>
                    &lt;/Col>
                    &lt;Col xs={2}/>
                    &lt;Col className={`issue-label-${issue.priority}`}>
                      &lt;b className="issue-text">{priorities[issue.priority]}&lt;/b>
                    &lt;/Col>
                  &lt;/Row>
                  [{(accountRole === '1') ?
                    'Employee' :
                    'Customer'}] {accountName} ·
                  created {getAge(issue.dateOpened + '+00:00')} ago
                &lt;/Container>
                &lt;hr className="issue-divider"/>
                &lt;Container>
                  &lt;p>Description: {issue.content}&lt;/p>
                &lt;/Container>
                &lt;hr className="issue-divider"/>
                &lt;Container>
                  &lt;Row>
                    &lt;Button onClick={resolve}>Mark as Resolved&lt;/Button>
                  &lt;/Row>
                  &lt;br/>
                  &lt;Row>
                    &lt;Form.Select defaultValue="none" onChange={(e) => {
                      setPriority(e.target.value);
                    }}>
                      &lt;option value="none" key="none" disabled hidden>
                        Select priority
                      &lt;/option>
                      {priorities.map((priority, idx) => (
                          (issue.priority !== idx &amp;&amp; priority !== 'None') ?
                              &lt;option value={idx}
                                key={idx}>{priority}&lt;/option> : null
                      ))}
                    &lt;/Form.Select>
                  &lt;/Row>
                  &lt;br/>
                  &lt;Row>
                    &lt;Button onClick={editPriority}>
                      {(priority === '' || priority === 'none') ? 'Change' : &lt;>
                        {(issue.priority > parseInt(priority)) ?
                            'Deescalate' :
                            'Escalate'} &lt;/>
                      }
                    &lt;/Button>
                  &lt;/Row>
                &lt;/Container>
              &lt;/div>
            &lt;/>
      }
    &lt;/>
  );
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Account.html">Account</a></li></ul><h3>Global</h3><ul><li><a href="global.html#accountFromCookies">accountFromCookies</a></li><li><a href="global.html#AccountProvider">AccountProvider</a></li><li><a href="global.html#signIn">signIn</a></li><li><a href="global.html#signOut">signOut</a></li><li><a href="global.html#useAccount">useAccount</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Sun May 01 2022 22:09:55 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
