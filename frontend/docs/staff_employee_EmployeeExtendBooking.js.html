<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: staff/employee/EmployeeExtendBooking.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: staff/employee/EmployeeExtendBooking.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* Purpose of file: Allow a staff member to extend a booking
for an unregistered user */

import React, {useEffect, useState} from 'react';
import {useNavigate, useParams} from 'react-router-dom';
import {Button, Col, Container, Form, Row} from 'react-bootstrap';
import {NotificationManager} from 'react-notifications';
import {useAccount} from '../../authorize';
import host from '../../host';
import showDate from '../../showDate';

/**
 * Renders the employee extend booking page, allows a staff member
 * to prolong a booking for an unregistered user
 * @return {JSX.Element} Employee extend booking page
 */
export default function EmployeeExtendGuestBooking() {
  const [account] = useAccount();
  const navigate = useNavigate();
  const {orderId} = useParams();
  const [baseOrder, setBaseOrder] = useState('');
  const [hireOptions, setHireOptions] = useState('');
  const [hireChoiceId, setHireChoiceId] = useState('');
  const [cardNo, setCardNo] = useState('');
  const [expiry, setExpiry] = useState('');
  const [cvv, setCVV] = useState('');
  const [validHireSlot, setValidHireSlot] = useState(true);
  const [validCardNo, setValidCardNo] = useState(true);
  const [validExpDate, setValidExpDate] = useState(true);
  const [validCVV, setValidCVV] = useState(true);

  useEffect(() => {
    fetchOrderInfo();
    fetchHirePeriods();
  }, []);

  /**
   * Gets detailed information of a specific order from the backend server
   */
  async function fetchOrderInfo() {
    try {
      const request = await fetch(host + `api/admin/Orders/${orderId}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json',
          'Authorization': `Bearer ${account.accessToken}`,
        },
        mode: 'cors',
      });
      const response = await request;
      if (response.status === 200) {
        setBaseOrder(await response.json());
      } else {
        navigate('/current-bookings');
        NotificationManager.error('Order does not exist', 'Error');
      }
    } catch (error) {
      console.error(error);
    }
  }

  /**
   * Gets list of hire periods from the backend server
   */
  async function fetchHirePeriods() {
    try {
      const request = await fetch(host + 'api/HireOptions', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json',
          'Authorization': `Bearer ${account.accessToken}`,
        },
        mode: 'cors',
      });
      setHireOptions((await request.json()).sort((a, b) => a.cost - b.cost));
    } catch (error) {
      console.error(error);
    }
  }

  /**
   * Checks that a chosen hire slot is valid
   * @param {boolean} stateChange Dynamically updates UI if true
   * @return {boolean} True if valid, false otherwise
   */
  function validateHireSlot(stateChange) {
    const valid = hireChoiceId !== '' &amp;&amp; hireChoiceId !== 'none';
    if (stateChange) {
      setValidHireSlot(valid);
    }
    return valid;
  }

  /**
   * Checks that the provided card number is valid
   * @param {boolean} stateChange Dynamically updates UI if true
   * @return {boolean} True if valid, false otherwise
   */
  function validateCardNo(stateChange) {
    const valid = cardNo.length > 9 &amp;&amp; cardNo.length &lt; 20;
    if (stateChange) {
      setValidCardNo(valid);
    }
    return valid;
  }

  /**
   * Checks that the provided expiry date of the card is valid
   * @param {boolean} stateChange Dynamically updates UI if true
   * @return {boolean} True if valid, false otherwise
   */
  function validateExpDate(stateChange) {
    const valid = expiry.match(/^(0[1-9]|1[0-2])\/?([0-9]{4}|[0-9]{2})$/);
    if (stateChange) {
      setValidExpDate(valid);
    }
    return valid;
  }

  /**
   * Checks that the provided CVV of the card is valid
   * @param {boolean} stateChange Dynamically updates UI if true
   * @return {boolean} True if valid, false otherwise
   */
  function validateCVV(stateChange) {
    const valid = cvv.match(/^[0-9]{3,4}$/);
    if (stateChange) {
      setValidCVV(valid);
    }
    return valid;
  }

  /**
   * If validations are passed and extension is valid, updates the
   * backend server and extends the booking
   */
  async function extendBooking() {
    let valid = true;
    const validateFuncs = [
      validateHireSlot,
      validateCardNo,
      validateCVV,
      validateExpDate];
    validateFuncs.forEach((validateTerm) => {
      if (valid) {
        valid = validateTerm(true);
      } else {
        validateTerm(true);
      }
    });
    if (!valid) {
      NotificationManager.error('Invalid Details Provided', 'Error');
    } else {
      try {
        const request = await fetch(
            host + `api/admin/Orders/${orderId}/extend`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
                'Authorization': `Bearer ${account.accessToken}`,
              },
              body: JSON.stringify({
                'hireOptionId': parseInt(hireChoiceId),
              }),
              mode: 'cors',
            });
        const response = await request;
        if (response.status !== 200) {
          NotificationManager.error('Could not extend booking.', 'Error');
        } else {
          NotificationManager.success('Extended booking.', 'Success');
          navigate('/bookings');
        }
      } catch (e) {
        console.log(e);
      }
    }
  }

  return (
    &lt;>
      &lt;p id="breadcrumb">
        &lt;a className="breadcrumb-list" onClick={() => {
          navigate('/home');
        }}>Home
        &lt;/a> &amp;gt; &lt;a className="breadcrumb-list" onClick={() => {
          navigate('/bookings');
        }}>Bookings&lt;/a> &amp;gt; &lt;b>
          &lt;a className="breadcrumb-current" onClick={() => {
            navigate('/create-guest-booking');
          }}>Create Booking&lt;/a>&lt;/b>
      &lt;/p>
      &lt;h3 id="pageName">Extend Booking&lt;/h3>
      &lt;hr id="underline"/>
      &lt;Container className="autoScrollSub">
        &lt;div className="issue-filters">
          &lt;h5>Customer Details&lt;/h5>
          &lt;Row className="pb-2 small-padding-top">
            &lt;Col className="text-end col-6 align-self-center">
                Name:
            &lt;/Col>
            &lt;Col>
              {(!baseOrder) ?
                    &lt;> Loading name... &lt;/> :
                    &lt;Form.Control value={baseOrder.account.name} disabled/>
              }
            &lt;/Col>
          &lt;/Row>
          &lt;Row className="pb-2">
            &lt;Col className="text-end align-self-center">
                Email Address:
            &lt;/Col>
            &lt;Col>
              {(!baseOrder) ?
                    &lt;> Loading email... &lt;/> :
                    &lt;Form.Control value={baseOrder.account.email} disabled/>
              }
            &lt;/Col>
          &lt;/Row>
          &lt;h5>Booking Details&lt;/h5>
          &lt;Row className="pb-2">
            &lt;Col className="text-end col-6 align-self-center">
                Depot:
            &lt;/Col>
            &lt;Col>
              {(!baseOrder) ?
                    &lt;> Loading depot... &lt;/> :
                    &lt;Form.Control value={baseOrder.scooter.depo.name} disabled/>
              }
            &lt;/Col>
          &lt;/Row>
          &lt;Row className="pb-2">
            &lt;Col className="text-end col-6 align-self-center">
                Start Date:
            &lt;/Col>
            &lt;Col>
              {(!baseOrder) ?
                    &lt;> Loading booking... &lt;/> :
                    &lt;Form.Control value={showDate(baseOrder.startTime)}
                      disabled/>
              }

            &lt;/Col>
          &lt;/Row>
          &lt;Row className="pb-2">
            &lt;Col className="text-end col-6 align-self-center">
                Hire Period:
            &lt;/Col>
            &lt;Col>
              {(hireOptions === '') ? &lt;>Loading hire periods...&lt;/> : &lt;>
                &lt;Form.Select isInvalid={!validHireSlot} defaultValue="none"
                  onChange={(e) => {
                    const value = e.target.value.split(',');
                    setHireChoiceId(value[0]);
                  }}>

                  &lt;option value="none" key="none" disabled hidden>Select Hire
                      Period
                  &lt;/option>
                  {hireOptions.map((option, idx) => (
                    &lt;option key={idx} value={[
                      option.hireOptionId,
                      option.cost]}>{option.name} -
                          £{option.cost}&lt;/option>
                  ))}
                &lt;/Form.Select>
              &lt;/>
              }
            &lt;/Col>
          &lt;/Row>
          &lt;h5>Payment details&lt;/h5>
          &lt;Row className="pb-2 small-padding-top">
            &lt;Col className="text-end col-6 align-self-center">
                Card Number:
            &lt;/Col>
            &lt;Col className="text-end">
              &lt;Form.Control type="text" placeholder="4000-1234-5678-9010"
                isInvalid={!validCardNo}
                onInput={(e) => setCardNo(e.target.value)}/>
              &lt;Form.Control.Feedback type="invalid">
                  Invalid Card Number
              &lt;/Form.Control.Feedback>
            &lt;/Col>
          &lt;/Row>
          &lt;Row className="pb-2">
            &lt;Col className="text-end col-6 align-self-center">
                Expiry Date:
            &lt;/Col>
            &lt;Col className="text-end">
              &lt;Form.Control type="text" placeholder="MM/YY"
                isInvalid={!validExpDate}
                onInput={(e) => setExpiry(e.target.value)}/>
              &lt;Form.Control.Feedback type="invalid">
                  Invalid Expiry Date
              &lt;/Form.Control.Feedback>
            &lt;/Col>
          &lt;/Row>
          &lt;Row className="pb-2">
            &lt;Col className="text-end col-6 align-self-center">
                CVV:
            &lt;/Col>
            &lt;Col className="text-end">
              &lt;Form.Control type="text" placeholder="123"
                isInvalid={!validCVV}
                onInput={(e) => setCVV(e.target.value)}/>
              &lt;Form.Control.Feedback type="invalid">
                  Invalid CVV
              &lt;/Form.Control.Feedback>

            &lt;/Col>
          &lt;/Row>
          &lt;Button onClick={extendBooking}>Extend Booking&lt;/Button>
        &lt;/div>
        &lt;div className="issue-filters-mobile">
          &lt;h5>Customer Details&lt;/h5>
          &lt;Row className="small-padding-bottom">
              Name:
            {(!baseOrder) ?
                  &lt;> Loading name... &lt;/> :
                  &lt;Form.Control value={baseOrder.account.name} disabled/>
            }
          &lt;/Row>
          &lt;Row className="small-padding-bottom">
              Email Address:
            {(!baseOrder) ?
                  &lt;> Loading email... &lt;/> :
                  &lt;Form.Control value={baseOrder.account.email} disabled/>
            }
          &lt;/Row>
          &lt;br/>
          &lt;h5>Booking Details&lt;/h5>
          &lt;Row className="small-padding-bottom">
              Depot:
            {(!baseOrder) ?
                  &lt;> Loading depot... &lt;/> :
                  &lt;Form.Control value={baseOrder.scooter.depo.name} disabled/>
            }
          &lt;/Row>
          &lt;Row className="small-padding-bottom">
              Start Date:
            {(!baseOrder) ?
                  &lt;> Loading booking... &lt;/> :
                  &lt;Form.Control value={showDate(baseOrder.startTime)} disabled/>
            }
          &lt;/Row>
          &lt;Row className="small-padding-bottom">
              Hire Period:
            {(hireOptions === '') ? &lt;>Loading hire periods...&lt;/> : &lt;>
              &lt;Form.Select isInvalid={!validHireSlot} defaultValue="none"
                onChange={(e) => {
                  const value = e.target.value.split(',');
                  setHireChoiceId(value[0]);
                }}>

                &lt;option value="none" key="none" disabled hidden>Select Hire
                    Period
                &lt;/option>
                {hireOptions.map((option, idx) => (
                  &lt;option key={idx} value={[
                    option.hireOptionId,
                    option.cost]}>{option.name} -
                        £{option.cost}&lt;/option>
                ))}
              &lt;/Form.Select>
            &lt;/>
            }
          &lt;/Row>
          &lt;br/>
          &lt;h5>Payment details&lt;/h5>
          &lt;Row className="small-padding-bottom">
              Card Number:
            &lt;Form.Control type="text" placeholder="4000-1234-5678-9010"
              isInvalid={!validCardNo}
              onInput={(e) => setCardNo(e.target.value)}/>
            &lt;Form.Control.Feedback type="invalid">
                Invalid Card Number
            &lt;/Form.Control.Feedback>
          &lt;/Row>
          &lt;Row className="small-padding-bottom">
              Expiry Date:
            &lt;Form.Control type="text" placeholder="MM/YY"
              isInvalid={!validExpDate}
              onInput={(e) => setExpiry(e.target.value)}/>
            &lt;Form.Control.Feedback type="invalid">
                Invalid Expiry Date
            &lt;/Form.Control.Feedback>
          &lt;/Row>
          &lt;Row className="small-padding-bottom">
              CVV:
            &lt;Form.Control type="text" placeholder="123"
              isInvalid={!validCVV}
              onInput={(e) => setCVV(e.target.value)}/>
            &lt;Form.Control.Feedback type="invalid">
                Invalid CVV
            &lt;/Form.Control.Feedback>
          &lt;/Row>
          &lt;div className="text-center large-padding-top small-padding-bottom">
            &lt;Button onClick={extendBooking}>Extend Booking&lt;/Button>
          &lt;/div>
        &lt;/div>
      &lt;/Container>
    &lt;/>
  );
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Account.html">Account</a></li></ul><h3>Global</h3><ul><li><a href="global.html#accountFromCookies">accountFromCookies</a></li><li><a href="global.html#AccountProvider">AccountProvider</a></li><li><a href="global.html#signIn">signIn</a></li><li><a href="global.html#signOut">signOut</a></li><li><a href="global.html#useAccount">useAccount</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Sun May 01 2022 22:09:55 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
